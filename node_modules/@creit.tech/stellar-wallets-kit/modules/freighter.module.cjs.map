{"version":3,"file":"freighter.module.cjs","sources":["../../src/modules/freighter.module.ts"],"sourcesContent":["import {\n  isConnected,\n  signTransaction,\n  signAuthEntry,\n  requestAccess,\n  signMessage,\n  getNetwork,\n  getAddress,\n} from '@stellar/freighter-api';\nimport { ModuleInterface, ModuleType } from '../types';\nimport { parseError } from '../utils';\nimport { Buffer } from 'buffer';\n\ndeclare const window: Window &\n  typeof globalThis & {\n  stellar?: {\n    provider: string;\n    platform: string;\n    version: string;\n  };\n};\n\nexport const FREIGHTER_ID = 'freighter';\n\nexport class FreighterModule implements ModuleInterface {\n  moduleType: ModuleType = ModuleType.HOT_WALLET;\n\n  productId: string = FREIGHTER_ID;\n  productName: string = 'Freighter';\n  productUrl: string = 'https://freighter.app';\n  productIcon: string = 'https://stellar.creit.tech/wallet-icons/freighter.png';\n\n  async runChecks(): Promise<void> {\n    if (!(await this.isAvailable())) {\n      throw new Error('Freighter is not connected');\n    }\n  }\n\n  async isAvailable(): Promise<boolean> {\n    // If these values are set it means we are loading the module from the Freighter's mobile version and so we need to\n    // use WalletConnect instead.\n    if (window.stellar?.provider === 'freighter' && window.stellar?.platform === 'mobile') return false;\n\n    return isConnected()\n      .then(({ isConnected, error }) => !error && isConnected)\n      .catch((): boolean => false);\n  }\n\n  async getAddress(params: { skipRequestAccess?: boolean }): Promise<{ address: string }> {\n    return this.runChecks()\n      .then(async () => {\n        if (params?.skipRequestAccess) return true;\n        return requestAccess();\n      })\n      .then(() => getAddress())\n      .then(({ address, error }) => {\n        if (error) throw error;\n        if (!address) throw {\n          code: -3,\n          message: 'Getting the address is not allowed, please request access first.',\n        };\n\n        return { address };\n      })\n      .catch(e => {\n        throw parseError(e);\n      });\n  }\n\n  async signTransaction(\n    xdr: string,\n    opts?: {\n      networkPassphrase?: string;\n      address?: string;\n      path?: string;\n      submit?: boolean;\n      submitUrl?: string;\n    }\n  ): Promise<{ signedTxXdr: string; signerAddress?: string }> {\n    return this.runChecks()\n      .then(async () => {\n        const { signedTxXdr, signerAddress, error } = await signTransaction(xdr, {\n          address: opts?.address,\n          networkPassphrase: opts?.networkPassphrase,\n        });\n\n        if (error) throw error;\n\n        return { signedTxXdr, signerAddress: signerAddress };\n      })\n      .catch(e => {\n        throw parseError(e);\n      });\n  }\n\n  async signAuthEntry(\n    authEntry: string,\n    opts?: {\n      networkPassphrase?: string;\n      address?: string;\n      path?: string;\n    }\n  ): Promise<{ signedAuthEntry: string; signerAddress?: string }> {\n    return this.runChecks()\n      .then(async () => {\n        const { signedAuthEntry, signerAddress, error } = await signAuthEntry(authEntry, {\n          address: opts?.address,\n          networkPassphrase: opts?.networkPassphrase,\n        });\n\n        if (error || !signedAuthEntry) throw error;\n\n        return { signedAuthEntry: Buffer.from(signedAuthEntry).toString('base64'), signerAddress: signerAddress };\n      })\n      .catch(e => {\n        throw parseError(e);\n      });\n  }\n\n  async signMessage(\n    message: string,\n    opts?: {\n      networkPassphrase?: string;\n      address?: string;\n      path?: string;\n    }\n  ): Promise<{ signedMessage: string; signerAddress?: string }> {\n    return this.runChecks()\n      .then(async () => {\n        const { signedMessage, signerAddress, error } = await signMessage(message, {\n          address: opts?.address,\n          networkPassphrase: opts?.networkPassphrase,\n        });\n\n        if (error || !signedMessage) throw error;\n\n        return {\n          signedMessage: typeof signedMessage === 'string'\n            ? signedMessage\n            : Buffer.from(signedMessage).toString('base64'),\n          signerAddress: signerAddress\n        };\n      })\n      .catch(e => {\n        throw parseError(e);\n      });\n  }\n\n  async getNetwork(): Promise<{ network: string; networkPassphrase: string }> {\n    return this.runChecks()\n      .then(async () => {\n        const { network, networkPassphrase, error } = await getNetwork();\n\n        if (error) throw error;\n\n        return { network, networkPassphrase };\n      })\n      .catch(e => {\n        throw parseError(e);\n      });\n  }\n}\n"],"names":["ModuleType","isConnected","requestAccess","getAddress","parseError","signTransaction","signAuthEntry","Buffer","signMessage","getNetwork"],"mappings":"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"}