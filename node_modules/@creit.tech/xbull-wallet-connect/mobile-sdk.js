import{EventType as e}from"./interfaces.js";class r{constructor(){this.isConnected=!1}sendEventToContentScript(e,r,o){return new Promise((s=>{const t=e=>{if(e.source!==window||!e.data||e.origin!==window.origin)return;e.data.eventId===o&&(s(e),window.removeEventListener("message",t,!1))};window.addEventListener("message",t,!1),window.webkit.messageHandlers.cordova_iab.postMessage(JSON.stringify({type:e,eventId:o,detail:r}))}))}async enableConnection(){const r={origin:window.origin,host:window.location.host,permissions:{canRequestPublicKey:!0,canRequestSign:!0}},o=await this.sendEventToContentScript(e.XBULL_CONNECT,r,crypto.randomUUID()),{detail:s}=o.data;if(!s||s.error)throw{code:s?.code||-1,message:s?.errorMessage||"Unexpected error"};this.isConnected=!0}async getAddress(){try{await this.enableConnection()}catch(e){return{error:{code:e?.code||-1,message:e?.message||"Unexpected error"}}}const r={origin:window.origin,host:window.location.host},o=await this.sendEventToContentScript(e.XBULL_GET_PUBLIC_KEY,r,crypto.randomUUID()),{detail:s}=o.data;return!s||s.error?{error:{code:s?.code||-1,message:s?.errorMessage||"Unexpected error"}}:{address:s.payload}}async signTransaction(r){if(r.opts?.submit||r.opts?.submitUrl)return{error:{code:-1,message:"Parameters `submit` and `submitUrl` are not supported"}};try{await this.enableConnection()}catch(e){return{error:{code:e?.code||-1,message:e?.message||"Unexpected error"}}}const o={origin:window.origin,host:window.location.host,network:r.opts?.networkPassphrase,publicKey:r.opts?.address,xdr:r.xdr,xdrType:"Transaction"},s=await this.sendEventToContentScript(e.XBULL_SIGN_XDR,o,crypto.randomUUID()),{detail:t}=s.data;return!t||t.error?{error:{code:t?.code||-1,message:t?.errorMessage||"Unexpected error"}}:{signedTxXdr:t.payload.signedXdr,signerAddress:t.payload.signerAddress}}async signMessage(r,o){if(!r)return{error:{code:-1,message:"The message must be defined."}};try{await this.enableConnection()}catch(e){return{error:{code:e?.code||-1,message:e?.message||"Unexpected error"}}}const s={origin:window.origin,host:window.location.host,message:r,publicKey:o?.address,network:o?.networkPassphrase},t=await this.sendEventToContentScript(e.XBULL_SIGN_MESSAGE,s,crypto.randomUUID()),{detail:n}=t.data;return!n||n.error?{error:{code:n?.code||-1,message:n?.errorMessage||"Unexpected error"}}:{signedMessage:n.payload.signedMessage,signerAddress:n.payload.signerAddress}}async getNetwork(){try{await this.enableConnection()}catch(e){return{error:{code:e?.code||-1,message:e?.message||"Unexpected error"}}}const r={origin:window.origin,host:window.location.host},o=await this.sendEventToContentScript(e.XBULL_GET_NETWORK,r,crypto.randomUUID()),{detail:s}=o.data;return!s||s.error?{error:{code:s?.code||-1,message:s?.errorMessage||"Unexpected error"}}:{network:s.payload.network,networkPassphrase:s.payload.networkPassphrase}}}export{r as xBullSDK};
//# sourceMappingURL=mobile-sdk.js.map
